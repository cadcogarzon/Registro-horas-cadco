<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Registro de horas - Cadco</title>
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/1995/1995526.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
        h1 { color: #333; }
        input, button { padding: 8px; margin: 5px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #aaa; padding: 8px; text-align: center; }
        th { background-color: #ddd; }
        .no-edit { background-color: #eee; }
    </style>
</head>
<body>
    <h1>Registro de horas - Cadco</h1>

    <label>Hora inicial del odómetro:</label>
    <input type="number" id="horaInicial" step="0.1"><br>

    <label>Hora final del odómetro:</label>
    <input type="number" id="horaFinal" step="0.1"><br>

    <label>Nombre del encargado:</label>
    <input type="text" id="encargado"><br>

    <button onclick="guardarRegistro()">Guardar</button>
    <button onclick="window.print()">Imprimir</button>

    <table id="tablaRegistros">
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Encargado</th>
                <th>Hora Inicial</th>
                <th>Hora Final</th>
                <th>Horas Trabajadas</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        function guardarRegistro() {
            const horaInicial = parseFloat(document.getElementById("horaInicial").value);
            const horaFinal = parseFloat(document.getElementById("horaFinal").value);
            const encargado = document.getElementById("encargado").value.trim();
            const fecha = new Date().toLocaleDateString();

            if (isNaN(horaInicial) || isNaN(horaFinal) || encargado === "" || horaFinal < horaInicial) {
                alert("Por favor, llena correctamente todos los campos.");
                return;
            }

            const horasTrabajadas = (horaFinal - horaInicial).toFixed(2);

            // Mostrar en la tabla local
            const tabla = document.getElementById("tablaRegistros").getElementsByTagName('tbody')[0];
            const fila = tabla.insertRow();
            [fecha, encargado, horaInicial, horaFinal, horasTrabajadas].forEach(texto => {
                const celda = fila.insertCell();
                celda.textContent = texto;
                celda.classList.add("no-edit");
            });

            // Enviar a Google Sheets
            fetch("https://script.google.com/macros/s/AKfycbyLMEHAp09ok4CxNjmEuXzXQc1Xs4_ZR8rteHjc7HA6dr8gnfx-UTSVonvlsiwVeTN8ag/exec", {
                method: "POST",
                body: JSON.stringify({
                    fecha,
                    encargado,
                    horaInicial,
                    horaFinal,
                    horasTrabajadas
                }),
                headers: {
                    "Content-Type": "application/json"
                }
            }).then(response => {
                if (!response.ok) throw new Error("Error en el envío a Google Sheets");
                return response.text();
            }).then(data => {
                console.log("Enviado a Sheets:", data);
            }).catch(error => {
                alert("Hubo un error al guardar en la nube.");
                console.error(error);
            });

            // Limpiar campos
            document.getElementById("horaInicial").value = "";
            document.getElementById("horaFinal").value = "";
            document.getElementById("encargado").value = "";
        }
    </script>
</body>
</html>
